---
name: anki-near-homophones
description: "User provides a word list (one line per card; a line can have multiple words). Source words and near-homophones must exist in a specified English vocabulary deck. Uses anki-mcp-server to find near-homophones (only from that deck), adds 助记. Output cards are Cloze: front = \"word：{{c1::词性. 释义}}\" per line, back = \"助记：...\". Use when the user asks to find 近形词、填空卡片、助记 from a word list or to add such cards."
---

# Anki 近形词工作流

**输入**：用户给出一个**单词列表**，**每行对应一张卡片**；**一行内可以写多个单词**（同一张卡片上的多个词，如易混词组）。  
**约束**：须指定**英语单词卡组**；**词源及其近形词必须都在该英语单词卡组内存在**，不在卡组内的词不得作为词源或近形词写入近形词卡片。  
为每张卡片找出近形词（衍生词、读音相近、词型相近），并为每对搭配**多元化记忆提示**，**先展示匹配结果供用户确认**，确认后再向近形词卡组添加新卡片（含记忆提示字段）。

## 输入约定

- **每行 = 一张卡片**：用户粘贴或输入的列表中，一行即一张卡片的「词源」。
- **一张卡片可有多个单词**：同一行内多个词用空格、逗号、斜杠等分隔（如 `affect / effect`、`their there they're`）。多词时视为「一组易混/相关词」，为其整体找近形词并生成区分型记忆提示。

**输入示例**（用户给出类似下面的列表，每行一张卡片）：

```
affect
desert
their there they're
principle principal
accept except
```

- 第 1 行：单词卡片「affect」→ 为其找近形词（如 effect）。
- 第 2 行：单词卡片「desert」→ 为其找近形词（如 dessert）。
- 第 3 行：多词卡片「their / there / they're」→ 整组易混词，生成组内区分 + 记忆提示。
- 第 4、5 行：同理，可为单词或多词。

## 卡片版式（填空型 Cloze）

生成的卡片为**填空类型**，一张卡片上**每行一个单词**，正面为「单词 + 填空释义」，背面为「助记」。

- **正面**（每行一个词，格式固定）：
  - 每行：`单词：{{c1::词性. 释义}}`
  - 词性缩写示例：a. 形容词，n. 名词，v. 动词，adv. 副词 等；释义用中文，多义用顿号/分号分隔。
  - 同一张卡片的多个填空使用**同一个** `{{c1::...}}`，以便一次点击显示全部释义。

**正面示例**（一张卡片，三个近形词）：

```
wizened：{{c1::a.干瘪的；枯萎的}}
wizen：{{c1::a. 干瘪的；枯萎的}}
wrinkle：{{c1::n. 皱纹、v. 起皱}}
```

- **背面**：
  - 固定字段：`助记：` + 本条卡片的记忆提示（词源/读音/拼写/联想等，见下方「记忆提示角度」）。

**背面示例**：

```
助记：wizen 为动词「使干瘪」；wizened 为形容词；wrinkle 皱纹、起皱，与「干瘪」意象相关，可一起记。
```

- **笔记类型**：使用 Anki 的 **Cloze**（填空）类型；创建笔记时字段需包含上述正面文本与背面「助记」内容（具体字段名以 `get_note_type_info` 查到的为准，常见为 Text / 正面 / 背面 或 Extra）。

## 前置条件

- 已配置并启用 **anki-mcp-server**（通过 AnkiConnect 连接本地 Anki）
- 须指定**英语单词卡组**（词源与近形词的词表来源）和「近形词」目标卡组
- **词源与近形词须在英语单词卡组内存在**：只有出现在该英语单词卡组中的词，才能作为词源或近形词出现在近形词卡片上；若某词不在该卡组内，则不得纳入（该行跳过或从候选中排除）

## 工作流

### 阶段一：解析列表并匹配近形词

1. **获取英语单词卡组词表并解析用户列表**
   - **先获取词表**：用 MCP `list_decks` 确认用户指定的**英语单词卡组**存在，再用 `search_notes` 查询该卡组下所有笔记，从笔记的单词字段（如 Front）提取**卡组内单词集合**（可做小写归一化便于匹配）。后续只承认该集合内的词为有效词源或近形词。
   - **解析用户输入**：用户给出一段文本，每行一张卡片。按行切分，得到若干「卡片」。
   - 对每一行按空格/逗号/斜杠等拆成**该卡片上的单词列表**（trim、去空、去重）。
   - 若用户希望「从某 Anki 卡组取词」：可直接用该卡组笔记按「每笔记一行」得到每行一卡；此时英语单词卡组可与词源卡组相同或不同，但词表仍以英语单词卡组为准。
   - 得到结构：`[ 卡片1的词列表, 卡片2的词列表, ... ]`；同时维护「英语单词卡组内词表」用于后续校验。

2. **为每张卡片找近形词（仅限卡组内词）**
   - **校验词源**：该卡片上的每个词（词源）必须在**英语单词卡组词表**内；若某行中有词不在卡组内，则该行跳过或单独标注「某词不在英语单词卡组内」，不纳入待生成卡片。
   - **单词卡片**：为该词列出衍生词、读音相近、词型相近；**只保留在英语单词卡组内存在的词**作为近形词，标类型：`衍生` / `读音相近` / `词型相近`。
   - **多词卡片**：本行多个词本身须均在卡组内；可视为一组近形/易混词，为组内做区分或补充更多近形词时，**补充的近形词也须在英语单词卡组内**。
   - 用你的语言知识先列出候选近形词，再与卡组词表取交集，只输出卡组内存在的近形词。

3. **为每张卡片上的每个词准备释义**
   - 为正面填空准备内容：每个词给出**词性 + 中文释义**（如 a. 干瘪的；枯萎的、n. 皱纹、v. 起皱）。
   - 词性缩写：a./adj. 形容词，n. 名词，v. 动词，adv. 副词 等；多义用顿号或分号分隔。
   - 若用户提供的列表中已带释义，可沿用或微调；否则用你的语言知识给出简明释义。

4. **为每对「原词–近形词」或每组易混词生成记忆提示**
   - 每条至少 1 条记忆提示；根据关系类型从「记忆提示角度」选 1～2 种（见下方）。
   - 多词卡片：可为「组内区分」生成一句式记忆提示（如 their 物主 / there 地点 / they're 他们是），写入背面「助记」。
   - 提示要简短、可背、易联想，避免长段落。

5. **整理成待确认列表**
   - 按「卡片」（即按行/按组）分组；每项包含：该卡片的词列表、每个词的释义（词性+释义）、关系类型、记忆提示（助记内容）、简短说明（可选）。

### 阶段二：展示结果并等待确认

6. **仅展示，不写入**
   - 用表格或清晰列表展示所有「卡片（可为多词）→ 各词释义 + 助记」，便于用户确认填空内容与助记后再写入。
   - 仅展示**词源与近形词均在英语单词卡组内**的项；若有某行因词源或近形词不在卡组内而被跳过，可单独列出并说明「某词不在英语单词卡组内」。
   - 多词卡片在「卡片（原词）」列写整组；「正面填空预览」列可列出每行的 `单词：词性. 释义`（即填空显示后的效果）；「助记」列即背面内容。
   - 示例格式：

   | 卡片（原词） | 正面填空预览（每行一词） | 关系类型 | 助记 |
   |--------------|--------------------------|----------|------|
   | wizened / wizen / wrinkle | wizened：a.干瘪的；枯萎的<br>wizen：a. 干瘪的；枯萎的<br>wrinkle：n. 皱纹、v. 起皱 | 词型/衍生 | wizen 为动词「使干瘪」；wizened 为形容词；wrinkle 与「干瘪」意象相关 |
   | affect / effect | affect：v. 影响<br>effect：n. 效果 | 读音相近 | affect 重音在前＝施加影响；effect 重音在后＝造成结果 |
   | desert | desert：n. 沙漠 / v. 抛弃 | — | （可补近形词 dessert 等） |

7. **明确征求用户确认**
   - 说明：「以上为匹配结果（每行对应一张填空卡片，正面每行一个单词+填空释义，背面为助记）。请确认要加入近形词卡组的项（可逐条说保留/删除）。确认后我将只对您同意的项在 Anki 中创建填空型卡片。」
   - **在用户明确确认前，不要调用 `create_note` 或 `batch_create_notes`。**

### 阶段三：确认后再写入 Anki

8. **确认后执行**
   - 若用户同意全部或部分：仅对用户确认的项执行添加（每项对应一张**填空型** Anki 卡片）。
   - 用 MCP：`create_deck` 确保目标卡组存在（如「近形词」或用户指定名称），**一次**即可。
   - 使用 **Cloze**（填空）笔记类型创建笔记；**优先用 `batch_create_notes` 一次创建用户确认的全部卡片**，避免逐条 `create_note`；在**近形词卡组**中创建。
   - **卡片内容格式**（填空型，每张卡片每行一个单词）：
     - **正面**：每行一个词，格式为 `单词：{{c1::词性. 释义}}`；同一张卡的所有填空使用同一个 `c1`，以便一次显示全部。多词则多行，例如：
       ```
       wizened：{{c1::a.干瘪的；枯萎的}}
       wizen：{{c1::a. 干瘪的；枯萎的}}
       wrinkle：{{c1::n. 皱纹、v. 起皱}}
       ```
     - **背面**：`助记：` + 本条卡片的记忆提示（词源/读音/拼写/联想等）。若 Cloze 类型的背面字段名为 Extra 或 助记，把生成的记忆提示写入该字段。
   - 先通过 `get_note_type_info` 确认 Cloze 类型的字段名（如 Text、Back、Extra），再按上述格式填充对应字段。

9. **反馈**
   - 简要列出已添加的卡片数量及卡组名；若有失败或跳过，一并说明。

## 使用 MCP 工具时的注意点

- **尽量合并操作，避免连续多次调用**：能用一次调用完成的就不要拆成多次。例如：用**一次** `search_notes` 拉取英语单词卡组内全部笔记并从中提取词表；用 **batch_create_notes** 一次创建用户确认的多张笔记，而不是逐条 `create_note`；若需查多条笔记信息，优先用批量接口（如 `notes_info` 一次传多个 noteId）而非循环单条 `get_note_info`。合并操作可减少往返、降低失败率。
- **英语单词卡组必选**：必须先指定**英语单词卡组**，并用 `search_notes` 拉取该卡组内所有单词，得到词表；**词源与近形词必须都在该词表内**，不在卡组内的词不得作为词源或近形词写入近形词卡片。
- **list_decks**：获取所有卡组时**调用一次**即可，用于定位英语单词卡组与近形词目标卡组。
- **search_notes**：**必须**用于查询英语单词卡组以得到卡组内词表；按 `deck:"英语单词卡组名"` **一次**查该卡组下所有笔记，从单词字段提取词表；若词源来自 Anki，也可在同一查询或一次查询中按「每笔记一行」得到每行一卡。
- **get_note_info** / **get_note_type_info**：需要时**各调用一次**（如一次 `get_note_type_info` 确认 Cloze 字段名），避免重复查询同一信息。
- **create_deck**：若不存在「近形词」卡组则先创建，**一次**即可。
- **create_note** / **batch_create_notes**：仅在用户确认后，向近形词卡组添加新笔记；**优先使用 batch_create_notes 一次创建用户确认的全部卡片**，避免对每张卡片单独调用 `create_note`。使用 **Cloze** 笔记类型；每张笔记对应「用户确认的一项」，正面为多行 `单词：{{c1::词性. 释义}}`，背面为「助记：」+ 记忆提示；指定 `deckName` 为目标近形词卡组。

## 近形词类型说明

| 类型 | 含义 | 示例 |
|------|------|------|
| 衍生 | 同词根/词缀，派生关系 | decide → decision, decisive |
| 读音相近 | 发音易混 | their / there / they're |
| 词型相近 | 拼写易混 | adapt / adopt, accept / except |

## 记忆提示角度（多元化）

为每条「原词–近形词」选最贴切的 1～2 种角度写记忆提示，避免千篇一律：

| 角度 | 适用类型 | 示例 |
|------|----------|------|
| **词源/词根** | 衍生、词型 | "port = 携带 → import 进口, export 出口"；"cept = 拿 → accept 接受, except 排除" |
| **读音对比** | 读音相近 | "affect 重音在前 / effect 重音在后"；"principal 末尾像 pal 朋友＝校长" |
| **拼写对比** | 词型相近 | "dessert 多一个 s = 甜点多一份"；"quiet 中间是 i = 安静一点" |
| **语义一句区分** | 读音/词型 | "affect 影响（动词） / effect 效果（名词）"；"desert 沙漠 / dessert 甜点" |
| **场景/例句** | 任意 | "effect: the effect of the drug（药的效果）"；"affect: it didn't affect me（没影响我）" |
| **联想/谐音** | 任意 | "principal 校长：校长是你的 pal"；"stationary 静止的：a 一个，站着不动" |
| **词性/搭配** | 衍生、易混 | "decide + to do / decision + to do 或 that 从句"；"advice 名 / advise 动" |
| **字母/形态口诀** | 词型 | "accept：先 accept 才能 except 排除别的"；"quite 很 / quiet 静：e 在最后＝很安静" |

- **衍生词**：优先用词根/词缀、词性变化、搭配区别。
- **读音相近**：优先用重音位置、元音差异、谐音或一句区分。
- **词型相近**：优先用「多/少哪字母」、拼写口诀、语义一句区分。
- 每条提示控制在 1～2 句话，便于写进卡片背面或「记忆提示」字段。

## 原则

- **输入**：用户给出单词列表，**每行对应一张卡片**；**一张卡片可以包含多个单词**（一行内用空格/逗号/斜杠分隔）。
- **词源与近形词须在英语单词卡组内存在**：须先指定英语单词卡组并拉取卡组词表；仅当词源及所选近形词均在该卡组内时，才可纳入近形词卡片；不在卡组内的词排除或标注。
- **卡片版式**：**填空型（Cloze）**；正面**每行一个单词**，格式为 `单词：{{c1::词性. 释义}}`；背面为「助记：」+ 记忆提示。
- **MCP 操作尽量合并**：通过 MCP 操作 Anki 时，尽量合并操作、避免连续多次调用；优先使用批量接口（如 batch_create_notes、一次 search_notes 拉全量），减少往返与失败率。
- **先展示、后写入**：匹配结果仅用于展示与确认，不默认写入。
- **用户确认是必须步骤**：未确认不调用任何写 Anki 的接口。
- **只添加用户同意的项**：用户可删减列表后再确认，只对最终确认列表写卡片。
